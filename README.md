# EDennis.MigrationsExtensions
This package provides extensions to Microsoft.EntityFrameworkCore.Migrations.MigrationBuilder to support SQL Server Temporal tables and/or TestJson tables.  

When you add ```migrationBuilder.SaveMappings();``` to the end of the Initial Migration's Up() method, the migrationBuilder saves table<->class mappings and column<->property mappings as SQL Server extended properties.  These extended properties are useful when you need to determine class names and property names from the information schema.  The EDennis.DataScaffolder Win Forms app will use these extended properties, when they are available.

When you add ```migrationBuilder.CreateMaintenanceProcedures();``` to the beginning of the Initial Migration's Up() method, the migrationBuilder generates a "_" schema (if needed) and creates a number of helpful stored procedures and functions: (a) ResetIdentities, which ensures that the next value for each identity specification is the maximum of the Id associated with the identity spec; (b) ResetSequences, which is similar to ResetIdentities, but with sequences; (c) GetMappings, which returns all entity framework mappings generated by the SaveMappings operation; (d) MaxDateTime2, which returns the maximum datimetime2 value; (e) RightBefore, which gets the datetime2 value that is 100 nanoseconds before the provided datetime2 parameter; and (f) RightAfter, which gets the datetime2 value that is 100 nanoseconds after the provided datetime2 parameter.  It is recommended to add ```migrationBuilder.DropMaintenanceProcedures();``` to the end of the Initial Migration's Drop() method.

When you add ```migrationBuilder.CreateSqlServerTemporalTables();``` to the beginning of the Initial Migration's Up() method, the migrationBuilder generates a "_" schema (if needed) and creates various stored procedures and functions used to maintain SQL Server temporal tables.   History tables are automatically generated for all tables having the appropriate SysStart and SysEnd columns with datetime2 data types and the appropriate default values.  It is recommended to add ```migrationBuilder.DropSqlServerTemporalTables();``` to the end of the Initial Migration's Drop() method.

When you add ```migrationBuilder.CreateTestJsonTableSupport();``` to the Initial Migration's Up() method, the migrationBuilder generates a "_maintenance" schema (if needed), creates a TestJson table, and creates a SaveTestJson stored procedure.   It is recommended to add ```migrationBuilder.DropTestJsonTableSupport();``` to the Initial Migration's Drop() method.

A ```migrationBuilder.DoTemporalInserts(path_to_sql_insert_file);``` method enables you to add insert statements to the end of any Up() method.  Temporal tables are disabled prior to the inserts and re-enabled after the inserts.  Also, all sequences and identities are updated after the inserts.  NOTE: This method only works if you have called CreateSqlServerTemporalTables() prior to calling this method.
